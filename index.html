<html>
  <head>
    <title>Browser API Proxy</title>
  </head>
  <body>
    <script type="text/javascript">
      const controller = new AbortController();
      const signal = controller.signal;

      async function init() {
        try {
          if ((await IdleDetector.requestPermission()) != 'granted') {
            console.error("Idle detection permission denied.");
            return;
          }

          const idleDetector = new IdleDetector();

          idleDetector.addEventListener("change", () => {
            const userState = idleDetector.userState;
            const screenState = idleDetector.screenState;
            console.log(`Idle change: ${userState}, ${screenState}.`);
          });

          await idleDetector.start({
            threshold: 60_000,
            signal,
          });
          console.log("IdleDetector is active.");
        } catch (err) {
          // Deal with initialization errors like permission denied,
          // running outside of top-level frame, etc.
          console.error(err.name, err.message);
        }
      }

    </script>

    <button onclick="init()">Start</button>

  </body>
</html>
